extends layout

block content
  // Page Wrapper
  #wrapper
    include helpers/sidebar
    // Content Wrapper
    #content-wrapper.d-flex.flex-column
      // Main Content
      #content
        include helpers/topbar
        // Begin Page Content
        .container-fluid
          // Page Heading
          .d-sm-flex.align-items-center.justify-content-between.mb-4
            h1.h3.mb-0.text-gray-800 Dashboard
          .row(style='width: 100%')
            form.user(action='/' method='POST' style='width: 100%')
              .row(style='width: 100%')
                .col
                  input#txtAnillamador.form-control(type='tel' aria-describedby='emailHelp' placeholder='Anillamador' name='txtAnillamador' required='true' pattern='[0-9]+' title='Only numbers')
                .col
                  input#txtDni.form-control(type='text' aria-describedby='emailHelp' placeholder='Personal Identification' name='txtDni' required='true')
                .col
                  select.form-control(name='txtPir' required='true')
                    option(selected='') Select one..
                    option(value='CONSULTA / COMERCIAL') CONSULTA / COMERCIAL
                    option(value='CONSULTA / FACTURACIÓN') CONSULTA / FACTURACIÓN
                    option(value='CONSULTA / TÉCNICO') CONSULTA / TÉCNICO
                    option(value='PETICIÓN / COMERCIAL') CONSULTA / COMERCIAL
                    option(value='PETICIÓN / FACTURACIÓN') CONSULTA / FACTURACIÓN
                    option(value='RECLAMO / FACTURACIÓN') RECLAMO / FACTURACIÓN
                    option(value='SOPORTE / COMERCIAL') SOPORTE / COMERCIAL
                    option(value='SOPORTE / TÉCNICO') SOPORTE / TÉCNICO
                .col
                  input#txtTicket.form-control(type='text' aria-describedby='emailHelp' placeholder='Ticket' name='txtTicket' required='true' pattern='[0-9]+' title='Only numbers')
                .col
                  input#txtTmo.form-control(type='text' aria-describedby='emailHelp' placeholder='Time mm:ss' name='txtTmo' required='true' pattern='[0-9]{2}:[0-9]{2}' title='Invalid format')
              .row.text-center(style='width: 100%')
                .col
                  br
                  button.btn.btn-outline-success.align-content-center(type='submit') Save
          // /.container-fluid
          br
          // DataTales Example
          .card.shadow.mb-4
            .card-header.py-3
              h6.m-0.font-weight-bold.text-primary Registry Data
            .card-body
              .table-responsive
                table#dataTable.table.table-bordered(width='100%' cellspacing='0')
                  thead
                    tr
                      th Anillamador
                      th Identification
                      th PIR
                      th Ticket
                      th Time
                      th Date
                  tfoot
                    tr
                      th Anillamador
                      th Identification
                      th PIR
                      th Ticket
                      th Time
                      th Date
                  tbody
                    tr.model
                      td(height='0')
                      td(height='0')
                      td(height='0')
                      td(height='0')
                      td(height='0')
                      td(height='0')
        // End of Main Content
        // Footer
        br
        footer.sticky-footer.bg-white
          .container.my-auto
            .copyright.text-center.my-auto
              span Copyright © RESONATELECOM S.A. 2019
          br
          .container.my-auto
            .copyright.text-center.my-auto
              span Developed by RKOrtega
        // End of Footer
        // End of Content Wrapper
        // End of Page Wrapper
        // Scroll to Top Button
        a.scroll-to-top.rounded(href='#page-top')
          i.fas.fa-angle-up
        include helpers/logout
  // The core Firebase JS SDK is always required and must be listed first
  script(src='https://www.gstatic.com/firebasejs/6.6.2/firebase-app.js')
  // Add Firebase products that you want to use
  script(src='https://www.gstatic.com/firebasejs/5.10.1/firebase-database.js')
  script.
    var user = "!{result}";
    console.log("Reference: "+user);
    var firebaseConfig = {
    apiKey: "AIzaSyBe7C2-8lUMP1KWPJ_-lkvKzu0ytl5fAME",
    authDomain: "resonatel.firebaseapp.com",
    databaseURL: "https://resonatel.firebaseio.com",
    projectId: "resonatel",
    storageBucket: "resonatel.appspot.com",
    messagingSenderId: "710009860039",
    appId: "1:710009860039:web:54d43ee0d8b8a4733ab3e2"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    var query = firebase.database().ref("tickets/"+user)
    console.log("database:" + query)
    query.once('value', snapshot => {
      snapshot.forEach(childSnapshot => {
        var table = document.getElementById("dataTable");
        var childData = childSnapshot.val(); console.log(childData)
        var row = table.insertRow(1);
        var cell1 = row.insertCell(0);
        var cell2 = row.insertCell(1);
        var cell3 = row.insertCell(2);
        var cell4 = row.insertCell(3);
        var cell5 = row.insertCell(4);
        var cell6 = row.insertCell(5);
        cell1.innerHTML = childData.anillamador
        cell2.innerHTML = childData.dni
        cell3.innerHTML = childData.pir
        cell4.innerHTML = childData.ticket
        cell5.innerHTML = childData.tmo
        cell6.innerHTML = childData.date
      })
    })