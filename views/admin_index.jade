extends layout

block content
    // Page Wrapper
    #wrapper
        include helpers/sidebar
        // Content Wrapper
        #content-wrapper.d-flex.flex-column
            // Main Content
            #content
                include helpers/topbar
                
                // Footer
                br
                footer.sticky-footer.bg-white
                    .container.my-auto
                        .copyright.text-center.my-auto
                            span Copyright Â© RESONATELECOM S.A. 2019
                    br
                    .container.my-auto
                        .copyright.text-center.my-auto
                            span Developed by RKOrtega
                // End of Footer
                // End of Content Wrapper
                // End of Page Wrapper
                // Scroll to Top Button
                a.scroll-to-top.rounded(href='#page-top')
                    i.fas.fa-angle-up
                include helpers/logout
    // The core Firebase JS SDK is always required and must be listed first
    script(src='https://www.gstatic.com/firebasejs/6.6.2/firebase-app.js')
    // Add Firebase products that you want to use
    script(src='https://www.gstatic.com/firebasejs/5.10.1/firebase-database.js')
    script.
        //Define variables
        var user = "!{result}";
        var result = [];
        //Firebase Config
        var firebaseConfig = {
        apiKey: "AIzaSyBe7C2-8lUMP1KWPJ_-lkvKzu0ytl5fAME",
        authDomain: "resonatel.firebaseapp.com",
        databaseURL: "https://resonatel.firebaseio.com",
        projectId: "resonatel",
        storageBucket: "resonatel.appspot.com",
        messagingSenderId: "710009860039",
        appId: "1:710009860039:web:54d43ee0d8b8a4733ab3e2"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        // Get reference
        var query = firebase.database().ref("tickets/"+user)
        var count = 0
        var minutes = 0
        var seconds = 0
        var duration = 0
        var tmo = 0
        function addRow(data){
            var table = $('#dataTable').DataTable();
            minutes = minutes + parseInt(data.tmo.substr(0, 2), 10)
            seconds = seconds + parseInt(data.tmo.substr(3, 4), 10)
            duration = (seconds*1000) + (minutes*60000)
            count++
            tmo = duration/count
            var mm = parseInt((tmo/(1000*60))) < 10 ? '0' + parseInt((tmo/(1000*60))) : parseInt((tmo/(1000*60)))
            var ss = parseInt((tmo/1000)%60) < 10 ? '0' + parseInt((tmo/1000)%60) : parseInt((tmo/1000)%60)
            var promedioTmo = 'Promedio TMO: ' + mm + ':' + ss
            document.getElementById("promedioTmo").innerHTML = promedioTmo
            table.row.add([
                data.anillamador,
                data.dni,
                data.pir,
                data.ticket,
                data.tmo
            ]).draw(true);
        }
        // Query database
        query.once('value', snapshot => {
        snapshot.forEach(childSnapshot => {
        result = childSnapshot.val()
        var date = new Date;
        var day = '' + date.getDate();
        var month = '' + (date.getMonth()+1)
        if (day.length <= 1) {
        day = '0' + day;
        }
        if (month.length <= 1) {
        month = '0' + month;
        }
        today = day + '/' + month + '/' + date.getFullYear()
        if(result.date == today){
            addRow(result)
        }
        })
        })